import{r as d,j as e,S as I}from"./app-DNCPaP7U.js";import{B as h}from"./button-Bt6djNs2.js";import{I as M}from"./input-QCWzT-kU.js";import{T as j}from"./textarea-DEN-g5ox.js";import{L as o}from"./label-BOqwU0X1.js";import{S as g,a as v,b as y,c as b,d as p,T as $,e as z,f as N,g as c,h as W,i as r}from"./select-DRy1P8Fc.js";import{P as X}from"./plus-DF7GOBCn.js";import{X as E}from"./x-DW-vgWTY.js";import{F as q}from"./filter-CKwhiPJ7.js";import"./utils-9LinqH4U.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-Ce72M_cX.js";const f=[{value:"documentation",label:"Documentation Issues"},{value:"medication",label:"Medication Reconciliation"},{value:"transportation",label:"Transportation Delays"},{value:"placement",label:"Placement Issues"},{value:"clinical",label:"Clinical Readiness"},{value:"social",label:"Social/Family Factors"},{value:"other",label:"Other"}],w=[{value:"high",label:"High Impact",color:"text-red-500"},{value:"medium",label:"Medium Impact",color:"text-yellow-500"},{value:"low",label:"Low Impact",color:"text-green-500"}];function re({cycleId:T,initialFailures:L=[]}){var F;const[n,G]=d.useState(L),[C,x]=d.useState(!1),[u,R]=d.useState("all"),[t,i]=d.useState({date:new Date().toISOString().split("T")[0],type:"",description:"",impact:"medium",rootCause:"",actionTaken:""}),[B,S]=d.useState(!1),[l,H]=d.useState({}),O=async s=>{s.preventDefault(),S(!0);try{await I.post(`/improvement/pdsa/${T}/discharge-failures`,t,{onSuccess:()=>{i({date:new Date().toISOString().split("T")[0],type:"",description:"",impact:"medium",rootCause:"",actionTaken:""}),x(!1)},onError:a=>{H(a)}})}finally{S(!1)}},P=async s=>{if(confirm("Are you sure you want to remove this event?"))try{await I.delete(`/improvement/pdsa/${T}/discharge-failures/${s}`)}catch(a){console.error("Failed to delete failure:",a)}},D=u==="all"?n:n.filter(s=>s.type===u),V=n.reduce((s,a)=>(s[a.type]=(s[a.type]||0)+1,s),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Discharge Failures Analysis"}),!C&&e.jsxs(h,{onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Add Failure Event"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total Events"}),e.jsx("p",{className:"text-2xl font-bold",children:n.length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"High Impact Events"}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:n.filter(s=>s.impact==="high").length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Most Common Type"}),e.jsx("p",{className:"text-2xl font-bold",children:((F=Object.entries(V).sort((s,a)=>a[1]-s[1])[0])==null?void 0:F[0])||"N/A"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Last 7 Days"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>{const a=new Date;return a.setDate(a.getDate()-7),new Date(s.date)>=a}).length})]})]}),C&&e.jsxs("form",{onSubmit:O,className:"bg-gray-50 p-4 rounded-lg border space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:"Add New Failure Event"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>x(!1),children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"date",children:"Date"}),e.jsx(M,{id:"date",type:"date",value:t.date,onChange:s=>i({...t,date:s.target.value})}),l.date&&e.jsx("p",{className:"text-sm text-red-500",children:l.date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"type",children:"Failure Type"}),e.jsxs(g,{value:t.type,onValueChange:s=>i({...t,type:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Select type"})}),e.jsx(b,{children:f.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))})]}),l.type&&e.jsx("p",{className:"text-sm text-red-500",children:l.type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(j,{id:"description",value:t.description,onChange:s=>i({...t,description:s.target.value}),placeholder:"Describe what happened...",rows:2}),l.description&&e.jsx("p",{className:"text-sm text-red-500",children:l.description})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"impact",children:"Impact Level"}),e.jsxs(g,{value:t.impact,onValueChange:s=>i({...t,impact:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Select impact"})}),e.jsx(b,{children:w.map(s=>e.jsx(p,{value:s.value,className:s.color,children:s.label},s.value))})]}),l.impact&&e.jsx("p",{className:"text-sm text-red-500",children:l.impact})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"rootCause",children:"Root Cause Analysis"}),e.jsx(j,{id:"rootCause",value:t.rootCause,onChange:s=>i({...t,rootCause:s.target.value}),placeholder:"What were the underlying causes?",rows:2}),l.rootCause&&e.jsx("p",{className:"text-sm text-red-500",children:l.rootCause})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"actionTaken",children:"Action Taken"}),e.jsx(j,{id:"actionTaken",value:t.actionTaken,onChange:s=>i({...t,actionTaken:s.target.value}),placeholder:"What actions were taken to address this?",rows:2}),l.actionTaken&&e.jsx("p",{className:"text-sm text-red-500",children:l.actionTaken})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(h,{type:"submit",disabled:B,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Add Event"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-500"}),e.jsxs(g,{value:u,onValueChange:R,children:[e.jsx(v,{className:"w-[200px]",children:e.jsx(y,{placeholder:"Filter by type"})}),e.jsxs(b,{children:[e.jsx(p,{value:"all",children:"All Types"}),f.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Impact"}),e.jsx(c,{children:"Root Cause"}),e.jsx(c,{children:"Action Taken"}),e.jsx(c,{className:"w-[100px]",children:"Actions"})]})}),e.jsxs(W,{children:[D.map(s=>{var a,k,A;return e.jsxs(N,{children:[e.jsx(r,{children:new Date(s.date).toLocaleDateString()}),e.jsx(r,{children:(a=f.find(m=>m.value===s.type))==null?void 0:a.label}),e.jsx(r,{children:s.description}),e.jsx(r,{children:e.jsx("span",{className:(k=w.find(m=>m.value===s.impact))==null?void 0:k.color,children:(A=w.find(m=>m.value===s.impact))==null?void 0:A.label})}),e.jsx(r,{children:s.rootCause}),e.jsx(r,{children:s.actionTaken}),e.jsx(r,{children:e.jsx(h,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700",onClick:()=>P(s.id),children:e.jsx(E,{className:"w-4 h-4"})})})]},s.id)}),D.length===0&&e.jsx(N,{children:e.jsx(r,{colSpan:7,className:"text-center text-gray-500",children:"No discharge failures recorded"})})]})]})]})}export{re as default};
