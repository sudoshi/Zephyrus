import{r as n,j as e,S as p}from"./app-DNCPaP7U.js";import{b as H}from"./index-BIRqetzA.js";import{B as o}from"./button-Bt6djNs2.js";import{T}from"./textarea-DEN-g5ox.js";import{L as x}from"./label-BOqwU0X1.js";import{S as j,a as v,b as g,c as b,d as f,T as L,e as V,f as y,g as c,h as M,i as r}from"./select-DRy1P8Fc.js";import{P as R}from"./plus-DF7GOBCn.js";import{X as B}from"./x-DW-vgWTY.js";import"./utils-9LinqH4U.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-Ce72M_cX.js";const N=[{value:"high",label:"High",color:"text-red-500"},{value:"medium",label:"Medium",color:"text-yellow-500"},{value:"low",label:"Low",color:"text-green-500"}],F=[{value:"identified",label:"Identified"},{value:"in_progress",label:"In Progress"},{value:"resolved",label:"Resolved"},{value:"blocked",label:"Blocked"}];function Y({cycleId:u,initialBarriers:P=H}){const[w,z]=n.useState(P),[S,d]=n.useState(!1),[a,l]=n.useState({description:"",priority:"medium",status:"identified",mitigation:""}),[A,C]=n.useState(!1),[m,k]=n.useState({}),D=async s=>{s.preventDefault(),C(!0);try{await p.post(`/improvement/pdsa/${u}/barriers`,a,{onSuccess:()=>{l({description:"",priority:"medium",status:"identified",mitigation:""}),d(!1)},onError:t=>{k(t)}})}finally{C(!1)}},$=async(s,t)=>{try{await p.post(`/improvement/pdsa/${u}/barriers/${s}/status`,{status:t})}catch(h){console.error("Failed to update status:",h)}},E=async s=>{if(confirm("Are you sure you want to remove this barrier?"))try{await p.delete(`/improvement/pdsa/${u}/barriers/${s}`)}catch(t){console.error("Failed to delete barrier:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Implementation Barriers"}),!S&&e.jsxs(o,{onClick:()=>d(!0),className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Add Barrier"]})]}),S&&e.jsxs("form",{onSubmit:D,className:"bg-gray-50 p-4 rounded-lg border space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:"Add New Barrier"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>d(!1),children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"Description"}),e.jsx(T,{id:"description",value:a.description,onChange:s=>l({...a,description:s.target.value}),placeholder:"Describe the barrier...",rows:2}),m.description&&e.jsx("p",{className:"text-sm text-red-500",children:m.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"priority",children:"Priority"}),e.jsxs(j,{value:a.priority,onValueChange:s=>l({...a,priority:s}),children:[e.jsx(v,{children:e.jsx(g,{placeholder:"Select priority"})}),e.jsx(b,{children:N.map(s=>e.jsx(f,{value:s.value,className:s.color,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"status",children:"Status"}),e.jsxs(j,{value:a.status,onValueChange:s=>l({...a,status:s}),children:[e.jsx(v,{children:e.jsx(g,{placeholder:"Select status"})}),e.jsx(b,{children:F.map(s=>e.jsx(f,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"mitigation",children:"Mitigation Plan"}),e.jsx(T,{id:"mitigation",value:a.mitigation,onChange:s=>l({...a,mitigation:s.target.value}),placeholder:"How will this barrier be addressed?",rows:2}),m.mitigation&&e.jsx("p",{className:"text-sm text-red-500",children:m.mitigation})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:A,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Add Barrier"})]})]}),e.jsxs(L,{children:[e.jsx(V,{children:e.jsxs(y,{children:[e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Priority"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Mitigation Plan"}),e.jsx(c,{className:"w-[100px]",children:"Actions"})]})}),e.jsxs(M,{children:[w.map(s=>{var t,h;return e.jsxs(y,{children:[e.jsx(r,{children:s.description}),e.jsx(r,{children:e.jsx("span",{className:(t=N.find(i=>i.value===s.priority))==null?void 0:t.color,children:(h=N.find(i=>i.value===s.priority))==null?void 0:h.label})}),e.jsx(r,{children:e.jsxs(j,{value:s.status,onValueChange:i=>$(s.id,i),children:[e.jsx(v,{className:"w-[130px]",children:e.jsx(g,{})}),e.jsx(b,{children:F.map(i=>e.jsx(f,{value:i.value,children:i.label},i.value))})]})}),e.jsx(r,{children:s.mitigation}),e.jsx(r,{children:e.jsx(o,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700",onClick:()=>E(s.id),children:e.jsx(B,{className:"w-4 h-4"})})})]},s.id)}),w.length===0&&e.jsx(y,{children:e.jsx(r,{colSpan:5,className:"text-center text-gray-500",children:"No barriers identified yet"})})]})]})]})}export{Y as default};
