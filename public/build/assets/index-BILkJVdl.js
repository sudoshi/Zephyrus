import{r as t,M as b,j as E,i as z}from"./app-DNCPaP7U.js";import{P as S,u as T,b as W,d as A}from"./create-factory-CkrcLOT8.js";class D extends t.Component{getSnapshotBeforeUpdate(c){const e=this.props.childRef.current;if(e&&c.isPresent&&!this.props.isPresent){const r=e.offsetParent,l=r instanceof HTMLElement&&r.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=l-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function H({children:f,isPresent:c,anchorX:e}){const r=t.useId(),l=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=t.useContext(b);return t.useInsertionEffect(()=>{const{width:g,height:o,top:m,left:s,right:p}=n.current;if(c||!l.current||!g||!o)return;const d=e==="left"?`left: ${s}`:`right: ${p}`;l.current.dataset.motionPopId=r;const u=document.createElement("style");return h&&(u.nonce=h),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${o}px !important;
            ${d}px !important;
            top: ${m}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[c]),E.jsx(D,{isPresent:c,childRef:l,sizeRef:n,children:t.cloneElement(f,{ref:l})})}const K=({children:f,initial:c,isPresent:e,onExitComplete:r,custom:l,presenceAffectsLayout:n,mode:h,anchorX:g})=>{const o=z(U),m=t.useId(),s=t.useCallback(d=>{o.set(d,!0);for(const u of o.values())if(!u)return;r&&r()},[o,r]),p=t.useMemo(()=>({id:m,initial:c,isPresent:e,custom:l,onExitComplete:s,register:d=>(o.set(d,!1),()=>o.delete(d))}),n?[Math.random(),s]:[e,s]);return t.useMemo(()=>{o.forEach((d,u)=>o.set(u,!1))},[e]),t.useEffect(()=>{!e&&!o.size&&r&&r()},[e]),h==="popLayout"&&(f=E.jsx(H,{isPresent:e,anchorX:g,children:f})),E.jsx(S.Provider,{value:p,children:f})};function U(){return new Map}const R=f=>f.key||"";function v(f){const c=[];return t.Children.forEach(f,e=>{t.isValidElement(e)&&c.push(e)}),c}const G=({children:f,custom:c,initial:e=!0,onExitComplete:r,presenceAffectsLayout:l=!0,mode:n="sync",propagate:h=!1,anchorX:g="left"})=>{const[o,m]=T(h),s=t.useMemo(()=>v(f),[f]),p=h&&!o?[]:s.map(R),d=t.useRef(!0),u=t.useRef(s),y=z(()=>new Map),[k,I]=t.useState(s),[C,j]=t.useState(s);W(()=>{d.current=!1,u.current=s;for(let a=0;a<C.length;a++){const i=R(C[a]);p.includes(i)?y.delete(i):y.get(i)!==!0&&y.set(i,!1)}},[C,p.length,p.join("-")]);const M=[];if(s!==k){let a=[...s];for(let i=0;i<C.length;i++){const x=C[i],w=R(x);p.includes(w)||(a.splice(i,0,x),M.push(x))}n==="wait"&&M.length&&(a=M),j(v(a)),I(s);return}const{forceRender:P}=t.useContext(A);return E.jsx(E.Fragment,{children:C.map(a=>{const i=R(a),x=h&&!o?!1:s===C||p.includes(i),w=()=>{if(y.has(i))y.set(i,!0);else return;let $=!0;y.forEach(L=>{L||($=!1)}),$&&(P==null||P(),j(u.current),h&&(m==null||m()),r&&r())};return E.jsx(K,{isPresent:x,initial:!d.current||e?void 0:!1,custom:x?void 0:c,presenceAffectsLayout:l,mode:n,onExitComplete:x?void 0:w,anchorX:g,children:a},i)})})};export{G as A};
