import{j as e,K as Y,r as u,L as P}from"./app-DNCPaP7U.js";import{D as W}from"./DashboardLayout-BfUOEmbm.js";import{C as g}from"./Card-Bb1H85Wn.js";import{P as M}from"./PrimaryButton-CBRwOkVO.js";import{M as A}from"./Modal-Fb8p8NaI.js";import{S as T}from"./cases-WZ7qXQk7.js";import{I as $}from"./iconify-CuDxMG-b.js";import{D as H}from"./data-service-BqqKZjIb.js";import{P as K}from"./PageContentLayout-DDKRpoW7.js";import"./useDarkMode-Cjnn_MHf.js";import"./TopNavigation-BPEMQkzy.js";import"./UserAvatar-DdRArJVQ.js";import"./DarkModeToggle-oH18ZJvw.js";import"./useFocusVisible-KZXt4Cm4.js";import"./portal-B_iHtz37.js";import"./transition-l3QoJGEh.js";import"./dialog-DfxhGoaS.js";import"./hidden-BGYz94zY.js";import"./room-status-CiRoKIFm.js";const Z=({value:i=new Date,onChange:l,renderDayContent:c,className:b=""})=>{const D=s=>{const r=s.getFullYear(),p=s.getMonth();return new Date(r,p+1,0).getDate()},y=s=>{const r=s.getFullYear(),p=s.getMonth();return new Date(r,p,1).getDay()},w=D(i),k=y(i),j=Array.from({length:w},(s,r)=>r+1),v=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],S=s=>{const r=new Date(i.getFullYear(),i.getMonth(),s);r.setHours(0,0,0,0),l(r)},N=s=>{const r=new Date(i);r.setMonth(r.getMonth()+s),r.setHours(0,0,0,0),r.setDate(1),l(r)},f=s=>{const r=new Date;return s.getMonth()===r.getMonth()&&s.getFullYear()===r.getFullYear()},x=s=>s===new Date().getDate()&&f(i);return e.jsxs("div",{className:`bg-white h-full flex flex-col ${b}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:i.toLocaleString("default",{month:"long",year:"numeric"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>N(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>N(1),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 flex-1 flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 text-center text-xs leading-6 text-gray-700",children:v.map(s=>e.jsx("div",{className:"bg-white py-2 font-semibold",children:s},s))}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-gray-200 min-h-full",children:[Array(k).fill(null).map((s,r)=>e.jsx("div",{className:"bg-white h-[120px]"},`empty-${r}`)),j.map(s=>{const r=new Date(i.getFullYear(),i.getMonth(),s),p=c?c(r):null;return e.jsxs("div",{onClick:()=>S(s),className:`bg-white p-2 cursor-pointer hover:bg-gray-50 min-h-[120px] overflow-y-auto ${x(s)?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm ${x(s)?"font-semibold text-blue-600":""}`,children:s}),p]},s)})]})})]})]})},a=({children:i,className:l="",...c})=>e.jsx("form",{className:l,...c,children:i}),q=({children:i,className:l=""})=>e.jsx("div",{className:`space-y-1 ${l}`,children:i}),G=({children:i,htmlFor:l,className:c=""})=>e.jsx("label",{htmlFor:l,className:`block text-sm font-medium text-gray-700 ${c}`,children:i}),J=({className:i="",...l})=>e.jsx("input",{className:`block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${i}`,...l});a.Field=q;a.Label=G;a.Input=J;const Q=()=>{var L;Y().props;const[i,l]=u.useState([]),[c,b]=u.useState(null),[D,y]=u.useState(!0),[w,k]=u.useState(null),j=H.useDataService(),[v,S]=u.useState(()=>{const t=new Date;return t.setHours(0,0,0,0),t}),[N,f]=u.useState(!1),[x,s]=u.useState([]),[r,p]=u.useState([]);u.useEffect(()=>{(async()=>{y(!0),k(null);try{const[n,o,m]=await Promise.all([j.getBlockTemplates().catch(h=>{throw console.error("Error fetching block templates:",h),new Error("Failed to load block templates")}),j.getBlockUtilization(v.toISOString().split("T")[0]).catch(h=>{throw console.error("Error fetching block utilization:",h),new Error("Failed to load block utilization")}),j.getServices().catch(h=>{throw console.error("Error fetching services:",h),new Error("Failed to load services")})]);l(n),b(o),s(m),p([{room_id:1,name:"OR-1"},{room_id:2,name:"OR-2"},{room_id:3,name:"OR-3"},{room_id:4,name:"OR-4"},{room_id:5,name:"OR-5"}])}catch(n){k(n.message||"Failed to load schedule data"),l([]),b(null),s([])}finally{y(!1)}})()},[v]);const z=t=>i.filter(n=>{const o=t.getDay()===0?7:t.getDay();return n.days_of_week.includes(o)}).map(n=>{var o,m;return{...n,block_date:t.toISOString().split("T")[0],service_name:(o=x.find(h=>h.service_id===n.service_id))==null?void 0:o.name,title:`${(m=x.find(h=>h.service_id===n.service_id))==null?void 0:m.name} Block`}}),F=t=>t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",[d,B]=u.useState({service_id:"",room_id:"",block_date:"",start_time:"",end_time:""}),_=(t,n)=>{B(o=>({...o,[t]:n}))},I=async t=>{var n,o;t.preventDefault();try{const m=d.block_date,h=`${m}T${d.start_time}:00`,R=`${m}T${d.end_time}:00`,U={block_id:i.length+1,room_id:d.room_id,service_id:d.service_id,service_name:(n=x.find(C=>C.service_id===d.service_id))==null?void 0:n.name,block_date:d.block_date,start_time:h,end_time:R,title:`${(o=x.find(C=>C.service_id===d.service_id))==null?void 0:o.name} Block`,days_of_week:[new Date(m).getDay()]};l([...i,U]),f(!1),B({service_id:"",room_id:"",block_date:"",start_time:"",end_time:""})}catch(m){console.error("Error creating block:",m)}},E=t=>{var o;const n=(o=c==null?void 0:c.utilization)==null?void 0:o.find(m=>m.block_id===t.block_id);return e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"font-medium",children:t.service_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[new Date(t.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(t.end_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]}),n&&e.jsxs("div",{className:`text-sm ${F(n.utilization_percentage)}`,children:[Math.round(n.utilization_percentage),"% Utilized"]})]})},O=t=>{const n=z(t);return n.length===0?null:e.jsx("div",{className:"mt-1",children:n.map(o=>e.jsx("div",{className:"text-xs bg-indigo-50 rounded-sm mb-1 overflow-hidden",children:E(o)},o.block_id))})};return D?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-600 border-t-transparent"})}):w?e.jsxs("div",{className:"p-6 text-center text-red-600",children:[e.jsx($,{icon:"heroicons:exclamation-circle",className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:w})]}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Block Schedule"}),e.jsxs(M,{variant:"primary",onClick:()=>f(!0),children:[e.jsx($,{icon:"heroicons:plus",className:"w-5 h-5 mr-2"}),"Add Block"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(g,{children:[e.jsxs(g.Header,{children:[e.jsx(g.Title,{children:"Block Utilization"}),e.jsx(g.Description,{children:"Last 30 days performance"})]}),e.jsx(g.Content,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:(L=c==null?void 0:c.utilization)==null?void 0:L.sort((t,n)=>n.utilization_percentage-t.utilization_percentage).slice(0,5).map(t=>e.jsx(g.Item,{title:t.title,subtitle:t.service_name,meta:e.jsxs("div",{className:`text-right ${F(t.utilization_percentage)}`,children:[Math.round(t.utilization_percentage),"%"]})},t.block_id))})})]})}),e.jsx(g,{className:"h-[calc(100vh-20rem)] flex flex-col",children:e.jsx(g.Content,{className:"flex-1 p-0 overflow-hidden",children:e.jsx("div",{className:"h-full w-full",children:e.jsx(Z,{value:v,onChange:S,renderDayContent:O,className:"h-full"})})})}),e.jsx(A,{show:N,onClose:()=>f(!1),maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add Block Time"}),e.jsxs(a,{onSubmit:I,className:"space-y-4",children:[e.jsxs(a.Field,{children:[e.jsx(a.Label,{children:"Service"}),e.jsx(T,{value:d.service_id,onChange:t=>_("service_id",t),options:x.map(t=>({label:t.name,value:t.service_id}))})]}),e.jsxs(a.Field,{children:[e.jsx(a.Label,{children:"Room"}),e.jsx(T,{value:d.room_id,onChange:t=>_("room_id",t),options:r.map(t=>({label:t.name,value:t.room_id}))})]}),e.jsxs(a.Field,{children:[e.jsx(a.Label,{children:"Date"}),e.jsx(a.Input,{type:"date",value:d.block_date,onChange:t=>_("block_date",t.target.value)})]}),e.jsxs(a.Field,{children:[e.jsx(a.Label,{children:"Start Time"}),e.jsx(a.Input,{type:"time",value:d.start_time,onChange:t=>_("start_time",t.target.value)})]}),e.jsxs(a.Field,{children:[e.jsx(a.Label,{children:"End Time"}),e.jsx(a.Input,{type:"time",value:d.end_time,onChange:t=>_("end_time",t.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(M,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(M,{variant:"primary",type:"submit",children:"Save Block"})]})]})]})})]})},fe=()=>e.jsxs(W,{children:[e.jsx(P,{title:"Block Schedule - ZephyrusOR"}),e.jsx(K,{title:"Block Schedule",subtitle:"Manage operating room block allocations",children:e.jsx(Q,{})})]});export{fe as default};
